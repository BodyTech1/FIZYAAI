<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ù…Ù†ØµØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù„Ù„ÙÙŠØ²ÙŠØ§Ø¡ ØªØ³Ø§Ø¹Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¹Ù„Ù‰ ØªØ¹Ù„Ù… Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø³Ù‡Ù„Ø© ÙˆÙ…Ù…ØªØ¹Ø©">
    <meta name="keywords" content="ÙÙŠØ²ÙŠØ§Ø¡, ØªØ¹Ù„ÙŠÙ…, Ù…Ù†ØµØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ©, Ø¯Ø±ÙˆØ³ ÙÙŠØ²ÙŠØ§Ø¡, Ø§Ù…ØªØ­Ø§Ù†Ø§Øª ÙÙŠØ²ÙŠØ§Ø¡, Ù…Ø°ÙƒØ±Ø§Øª ÙÙŠØ²ÙŠØ§Ø¡">
    <meta name="author" content="Ù…Ø³ØªØ± ÙŠØ§Ø³Ø± Ø¹Ù„ÙŠ">
    <meta property="og:title" content="ÙØ²ÙŠØ§Ø¦ÙŠ | Ù…Ù†ØµØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù„Ù„ÙÙŠØ²ÙŠØ§Ø¡">
    <meta property="og:description" content="Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§ ÙÙŠ ÙØ²ÙŠØ§Ø¦ÙŠ ÙˆØªØ¹Ù„Ù… Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø³Ù‡Ù„Ø© ÙˆÙ…Ù…ØªØ¹Ø© Ù…Ø¹ Ù…Ø³ØªØ± ÙŠØ§Ø³Ø± Ø¹Ù„ÙŠ">
    <meta property="og:image" content="ÙØ²ÙŠØ§Ø¦ÙŠ.png" >
    <meta property="og:type" content="website">
    <title>ÙØ²ÙŠØ§Ø¦ÙŠ | Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯Ø±Ø³</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="ÙØ²ÙŠØ§Ø¦ÙŠ.png">
</head>
<body>
    <!-- Navigation Bar -->
    <nav>
        <div class="navbar">
            <a href="index.html" class="logo">ÙØ²ÙŠØ§Ø¦ÙŠ</a>
            <div>
                <a href="teacher.html">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
                <div class="dropdown">
                    <a href="#">ğŸ“š Ø§Ù„ØµÙÙˆÙ</a>
                    <div class="dropdown-content">
                        <a href="class-1.html">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</a>
                        <a href="class-2.html">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</a>
                        <a href="class-3.html">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</a>
                    </div>
                </div>
                <a href="exams.html">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</a>
                <a href="teacher.html" id="teacher-dashboard" class="hidden">ğŸ‘¨â€ğŸ« Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
                <button onclick="toggleDarkMode()" id="dark-mode-btn">ğŸŒ™</button>
                <button onclick="logout()" id="logout-btn">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
            </div>
        </div>
    </nav>

    <!-- Teacher Dashboard Container -->
    <div class="container-large">
        <h1>ğŸ‘¨â€ğŸ« Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…Ù†ØµØ© ÙØ²ÙŠØ§Ø¦ÙŠ</h1>
        <p class="subtitle-text">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†</p>

        <!-- Statistics Cards -->
        

        <hr>

        <!-- Pending Requests Section -->
        <section>
            <h2 class="heading-warning">ğŸ“¥ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</h2>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                        </tr>
                    </thead>
                    <tbody id="pending-table">
                    
                
                    </tbody>
                </table>
            </div>
        </section>

        <hr>

        <!-- Add Zoom Meeting Section -->


        <!-- Approved Students Section -->
        <section>
            <h2 class="heading-success">âœ… Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„ÙŠÙ†</h2>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                        </tr>
                    </thead>
                    <tbody id="approved-table">
                        
                        
                    </tbody>
                </table>
            </div>
        </section>

        <hr>

        <section>
            <h2 class="heading-primary">ï¿½ Zoom: Ø¥Ø¶Ø§ÙØ© Ø§Ø¬ØªÙ…Ø§Ø¹ (Ù…Ø¨Ø§Ø´Ø±)</h2>
            <div class="form-container">
                <div class="form-grid">
                    <input type="text" id="meetingLink" placeholder="ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ (Zoom link)" required>
                    <select id="meetingClassZoom" required>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
                        <option value="1">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                        <option value="2">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                        <option value="3">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                    </select>
                </div>
                <div class="form-grid">
                    <input type="date" id="meetingDate" required>
                    <input type="time" id="meetingTime" required>
                </div>
                <button onclick="addMeetingFirebase()" class="btn btn-form">â• Ø¥Ø¶Ø§ÙØ© Ø§Ø¬ØªÙ…Ø§Ø¹ Zoom</button>
                <p id="meetingMessage" class="message-text"></p>
            </div>
        </section>

        <hr>

        <!-- Meetings Display Section -->
        <section>
            <h2 class="heading-primary">ğŸ“… Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h2>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„ØµÙ</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ø§Ù„ÙˆÙ‚Øª</th>
                            <th>Ø§Ù„Ø±Ø§Ø¨Ø·</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                        </tr>
                    </thead>
                    <tbody id="meetings-table">
                        <tr>
                            <td colspan="5" class="empty-cell">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <hr>


        <!-- Upload Exams Section -->
        <section>
            <h2 class="heading-primary">ğŸ“‹ Ø±ÙØ¹ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</h2>
            <div class="form-container">
                <div class="form-grid">
                    <div>
                        <label for="exam-class" class="form-label">Ø§Ø®ØªØ± Ø§Ù„ØµÙ:</label>
                        <select id="exam-class" required>
                            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØµÙ --</option>
                            <option value="1">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                            <option value="2">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                            <option value="3">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                        </select>
                    </div>
                    <div>
                        <label for="exam-name" class="form-label">Ø§Ø³Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†:</label>
                        <input type="text" id="exam-name" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„" required>
                    </div>
                    <div>
                        <label for="exam-file" class="form-label">Ø§Ø®ØªØ± ØµÙˆØ± Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† (Ø­ØªÙ‰ 4 ØµÙˆØ±):</label>
                        <input type="file" id="exam-file" accept="image/*" multiple required>
                    </div>
                </div>
                <textarea id="exam-description" placeholder="ğŸ“‘ ÙˆØµÙ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" class="form-textarea"></textarea>
                <button onclick="uploadExamFirebase()" class="btn btn-form">â¬†ï¸ Ø±ÙØ¹ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>
                <p id="exam-message" class="message-text"></p>
            </div>
        </section>

        <hr>

        <!-- Exams Display Section -->
        <section>
            <h2 class="heading-primary">ğŸ“‹ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©</h2>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„ØµÙˆØ±Ø©</th>
                            <th>Ø§Ø³Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</th>
                            <th>Ø§Ù„ÙˆØµÙ</th>
                            <th>Ø§Ù„ØµÙ</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±ÙØ¹</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                        </tr>
                    </thead>
                    <tbody id="exams-table">
                        <tr>
                            <td colspan="5" class="empty-cell">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <hr>

        <!-- Add Lesson Section -->
        <section>
            <h2 class="heading-primary">ğŸ“‘ Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯</h2>
            <div class="form-container">
                <div class="form-grid">
                    <input type="text" id="lessonTitle" placeholder="ğŸ“– Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³" required>
                    <select id="lessonClass" required>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
                        <option value="1">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                        <option value="2">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                        <option value="3">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                    </select>
                </div>
                <textarea id="lessonDescription" placeholder="ğŸ“‘ ÙˆØµÙ Ø§Ù„Ø¯Ø±Ø³" class="form-textarea"></textarea>
                <input type="text" id="lessonLink" placeholder="ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (YouTube)">
                <label for="lessonVideoFile" class="form-label">Ø£Ùˆ Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ:</label>
                <input type="file" id="lessonVideoFile" accept="video/*">
                <button onclick="addLessonFirebase()" class="btn btn-form">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø±Ø³</button>
                <p id="lessonMessage" class="message-text"></p>
            </div>
        </section>

        <hr>

        <!-- Lessons Management Section -->
        <section>
            <h2 class="heading-primary">ğŸ“š Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…Ø¶Ø§ÙØ©</h2>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³</th>
                            <th>Ø§Ù„ØµÙ</th>
                            <th>Ø§Ù„ÙˆØµÙ</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                        </tr>
                    </thead>
                    <tbody id="lessons-table">
                        
                    </tbody>
                </table>
            </div>
        </section>

        <hr>

        <!-- Centers Management Section (Teacher) -->
        <section>
            <h2 class="heading-primary">ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ø³Ù†ØªØ±</h2>
            <div class="form-container">
                <input type="hidden" id="editingCenterId" value="">
                <input type="text" id="centerName" placeholder="ğŸ·ï¸ Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙƒØ²">
                <input type="text" id="centerLink" placeholder="ğŸ”— Ø±Ø§Ø¨Ø· Ø®Ø±Ø§Ø¦Ø· Google (Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·)">
                <input type="text" id="centerDesc" placeholder="ğŸ“ ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                <div class="form-grid">
                    <input type="text" id="centerLat" placeholder="Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                    <input type="text" id="centerLng" placeholder="Ø®Ø· Ø§Ù„Ø·ÙˆÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                </div>
                <button onclick="addCenterFromDashboard()" class="btn btn-form">â• Ø¥Ø¶Ø§ÙØ©/Ø­ÙØ¸ Ø§Ù„Ù…Ø±ÙƒØ²</button>
                <p id="centerMessage" class="message-text"></p>
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„ÙˆØµÙ/Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                            <th>Ø§Ù„Ø±Ø§Ø¨Ø·</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                        </tr>
                    </thead>
                    <tbody id="centers-table">
                        <tr><td colspan="4" class="empty-cell">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±Ø§ÙƒØ²</td></tr>
                    </tbody>
                </table>
            </div>
        </section>
     <!--   <section style="text-align: center; padding: 30px; background: linear-gradient(135deg, rgba(26, 35, 126, 0.05) 0%, rgba(255, 215, 0, 0.05) 100%); border-radius: 12px;">
            <h2>âš™ï¸ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="alert('Ø³ÙŠØªÙ… ÙØªØ­ Ù…Ø­Ø±Ø± Ø§Ù„Ø¯Ø±ÙˆØ³')">ğŸ“ Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯</button>
                <button class="btn btn-secondary" onclick="alert('Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±')">ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
                <button class="btn btn-secondary" onclick="alert('Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©')">ğŸ’¬ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø·Ù„Ø§Ø¨</button>
                <button class="btn btn-secondary" onclick="alert('Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª')">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            </div>
        </section>
        -->
    </div>

    <!-- Footer -->
    <footer>
        <p>&copy; 2026 Ù…Ù†ØµØ© ÙØ²ÙŠØ§Ø¦ÙŠ - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
        <p>
            <a href="#">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a> | 
            <a href="#">Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</a> | 
            <a href="#">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a>
        </p>
    </footer>

    <script type="module" src="script.js"></script>
</body>
</html>
            const classNum = document.getElementById('exam-class').value;
            const examName = document.getElementById('exam-name').value.trim();
            const examDesc = document.getElementById('exam-description').value.trim();
            const files = document.getElementById('exam-file').files;
            const messageDiv = document.getElementById('exam-message');
            
            if (!classNum || !examName || files.length === 0) {
                messageDiv.innerHTML = '<span class="message error">âŒ Ø§Ø®ØªØ± Ø§Ù„ØµÙ ÙˆØ§Ø³Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† ÙˆØ§Ù„ØµÙˆØ±</span>';
                return;
            }
            
            if (files.length > 4) {
                messageDiv.innerHTML = '<span class="message error">âŒ Ù„Ø§ ØªØ³ØªØ·ÙŠØ¹ Ø±ÙØ¹ Ø£ÙƒØ«Ø± Ù…Ù† 4 ØµÙˆØ±</span>';
                return;
            }
            
            messageDiv.innerHTML = '<span class="message info">â³ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†...</span>';
            
            let imagesData = [];
            let loadedCount = 0;
            
            Array.from(files).forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = async function(e) {
                    imagesData[index] = e.target.result;
                    loadedCount++;
                    
                    if (loadedCount === files.length) {
                        try {
                            const examId = Date.now().toString();
                            const examData = {
                                id: examId,
                                class: parseInt(classNum),
                                name: examName,
                                description: examDesc,
                                images: imagesData,
                                date: new Date().toISOString().split('T')[0],
                                uploadedBy: 'teacher'
                            };
                            
                            await setDoc(doc(db, 'exams', examId), examData);
                            
                            const localExams = JSON.parse(localStorage.getItem('exams') || '[]');
                            localExams.unshift(examData);
                            localStorage.setItem('exams', JSON.stringify(localExams));
                            
                            document.getElementById('exam-class').value = '';
                            document.getElementById('exam-name').value = '';
                            document.getElementById('exam-description').value = '';
                            document.getElementById('exam-file').value = '';
                            messageDiv.innerHTML = '<span class="message success">âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©! (' + files.length + ' ØµÙˆØ±Ø©)</span>';
                            window.renderAllExams();
                            window.loadExamsFromCloud();
                            setTimeout(() => messageDiv.innerHTML = '', 3000);
                        } catch (error) {
                            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¹:', error);
                            messageDiv.innerHTML = '<span class="message error">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message + '</span>';
                        }
                    }
                };
                reader.readAsDataURL(file);
            });
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¯Ø±ÙˆØ³ ÙÙŠ Firebase
        window.addLessonFirebase = async function() {
            const title = document.getElementById('lessonTitle').value.trim();
            const classNum = document.getElementById('lessonClass').value.trim();
            const description = document.getElementById('lessonDescription').value.trim();
            const link = document.getElementById('lessonLink').value.trim();
            const messageDiv = document.getElementById('lessonMessage');

            if (!title || !classNum || !description) {
                messageDiv.innerHTML = '<span class="message error">âŒ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</span>';
                return;
            }

            try {
                const lessonId = Date.now().toString();
                const today = new Date().toISOString().split('T')[0];
                
                const lessonData = {
                    id: lessonId,
                    title: title,
                    class: classNum,
                    description: description,
                    link: link,
                    date: today
                };

                // Ø­ÙØ¸ ÙÙŠ Firebase
                await setDoc(doc(db, 'lessons', lessonId), lessonData);

                // Ø­ÙØ¸ ÙÙŠ localStorage
                let lessons = JSON.parse(localStorage.getItem('lessons') || '[]');
                lessons.push(lessonData);
                localStorage.setItem('lessons', JSON.stringify(lessons));

                messageDiv.innerHTML = '<span class="message success">âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­!</span>';
                document.getElementById('lessonTitle').value = '';
                document.getElementById('lessonClass').value = '';
                document.getElementById('lessonDescription').value = '';
                document.getElementById('lessonLink').value = '';
                
                window.loadLessonsFromCloud();
                
                setTimeout(() => {
                    messageDiv.innerHTML = '';
                    location.reload();
                }, 1500);
            } catch (error) {
                messageDiv.innerHTML = '<span class="message error">âŒ Ø®Ø·Ø£: ' + error.message + '</span>';
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ù…Ù† Firebase
        window.loadMeetingsFromCloud = function() {
            const q = query(collection(db, 'meetings'));
            onSnapshot(q, (snapshot) => {
                const meetings = [];
                snapshot.forEach((docSnap) => {
                    meetings.push(docSnap.data());
                });
                localStorage.setItem('meetings', JSON.stringify(meetings));
                window.renderMeetings();
                window.updateMeetingButtons();
            });
        }

        // Ø¥Ø¶Ø§ÙØ© Ø§Ø¬ØªÙ…Ø§Ø¹ Zoom (ÙŠØ­ÙØ¸ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª ÙƒØ±Ø§Ø¨Ø· Ù„Ù„ØªÙØ¹ÙŠÙ„ Ù‚Ø¨Ù„ 5 Ø¯Ù‚Ø§Ø¦Ù‚)
        window.addMeetingFirebase = async function() {
            const link = document.getElementById('meetingLink').value.trim();
            const classNum = document.getElementById('meetingClassZoom').value;
            const date = document.getElementById('meetingDate').value;
            const time = document.getElementById('meetingTime').value;
            const messageDiv = document.getElementById('meetingMessage');

            if (!link || !classNum || !date || !time) {
                messageDiv.innerHTML = '<span class="message error">âŒ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹</span>';
                return;
            }

            try {
                const datetimeStr = date + 'T' + time;
                const startTimestamp = new Date(datetimeStr).getTime();
                if (isNaN(startTimestamp)) {
                    messageDiv.innerHTML = '<span class="message error">âŒ ØªØ§Ø±ÙŠØ®/ÙˆÙ‚Øª ØºÙŠØ± ØµØ§Ù„Ø­</span>';
                    return;
                }

                const meetingId = Date.now().toString();
                const meetingData = {
                    id: meetingId,
                    link: link,
                    class: classNum,
                    datetime: datetimeStr,
                    startTimestamp: startTimestamp,
                    createdBy: 'teacher'
                };

                await setDoc(doc(db, 'meetings', meetingId), meetingData);

                let meetings = JSON.parse(localStorage.getItem('meetings') || '[]');
                meetings.unshift(meetingData);
                localStorage.setItem('meetings', JSON.stringify(meetings));

                document.getElementById('meetingLink').value = '';
                document.getElementById('meetingClassZoom').value = '';
                document.getElementById('meetingDate').value = '';
                document.getElementById('meetingTime').value = '';

                messageDiv.innerHTML = '<span class="message success">âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ Ø¨Ù†Ø¬Ø§Ø­</span>';
                window.renderMeetings();
                window.loadMeetingsFromCloud();
                setTimeout(() => messageDiv.innerHTML = '', 3000);
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹:', error);
                messageDiv.innerHTML = '<span class="message error">âŒ Ø®Ø·Ø£: ' + (error.message || error) + '</span>';
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        window.renderMeetings = function() {
            const table = document.getElementById('meetings-table');
            const meetings = JSON.parse(localStorage.getItem('meetings') || '[]');

            if (!table) return;

            if (meetings.length === 0) {
                table.innerHTML = '<tr><td colspan="5" class="empty-cell">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª</td></tr>';
                return;
            }

            table.innerHTML = '';
            const classMap = { '1': 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ', '2': 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ', '3': 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ' };

            meetings.forEach(m => {
                const dt = new Date(m.startTimestamp);
                const dateStr = dt.toLocaleDateString('ar-EG');
                const timeStr = dt.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });

                const row = table.insertRow();
                row.setAttribute('data-id', m.id);
                row.innerHTML = `
                    <td>${classMap[m.class] || m.class}</td>
                    <td>${dateStr}</td>
                    <td>${timeStr}</td>
                    <td><a href="${m.link}" target="_blank" rel="noopener">Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹</a></td>
                    <td>
                        <button id="join-${m.id}" class="btn btn-success btn-small" onclick="joinMeeting('${m.link}')" disabled>Ø§Ù†Ø¶Ù…</button>
                        <button class="btn btn-danger btn-small" onclick="deleteMeeting('${m.id}')">Ø­Ø°Ù</button>
                        <div id="join-info-${m.id}" style="font-size:0.85rem;color:var(--text-secondary);margin-top:6px"></div>
                    </td>
                `;
            });
        }

        // Ø­Ø°Ù Ø§Ø¬ØªÙ…Ø§Ø¹
        window.deleteMeeting = async function(id) {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ØŸ')) return;
            try {
                await deleteDoc(doc(db, 'meetings', id));
                let meetings = JSON.parse(localStorage.getItem('meetings') || '[]');
                meetings = meetings.filter(m => m.id !== id);
                localStorage.setItem('meetings', JSON.stringify(meetings));
                window.renderMeetings();
                window.loadMeetingsFromCloud();
                alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ Ø¨Ù†Ø¬Ø§Ø­');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹:', error);
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹: ' + (error.message || error));
            }
        }

        // ØªÙ…ÙƒÙŠÙ† Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù‚Ø¨Ù„ 5 Ø¯Ù‚Ø§Ø¦Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        window.updateMeetingButtons = function() {
            const meetings = JSON.parse(localStorage.getItem('meetings') || '[]');
            const now = Date.now();
            meetings.forEach(m => {
                const btn = document.getElementById('join-' + m.id);
                const info = document.getElementById('join-info-' + m.id);
                if (!btn) return;
                const enableAt = (m.startTimestamp || 0) - (5 * 60 * 1000);
                if (now >= enableAt && now <= (m.startTimestamp + (3 * 60 * 60 * 1000))) {
                    btn.disabled = false;
                    if (info) info.textContent = 'Ù…ÙØªÙˆØ­ Ø§Ù„Ø¢Ù†';
                } else if (now < enableAt) {
                    btn.disabled = true;
                    const mins = Math.ceil((enableAt - now) / 60000);
                    if (info) info.textContent = `ÙŠÙØªØ­ Ø¨Ø¹Ø¯ ${mins} Ø¯Ù‚ÙŠÙ‚Ø©`;
                } else {
                    btn.disabled = true;
                    if (info) info.textContent = 'Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª';
                }
            });
        }

        /* ------------------ Centers management (teacher) ------------------ */

        // Ø­Ø§ÙˆÙ„ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ù…Ù† Ø±Ø§Ø¨Ø· Google Maps
        window.parseCoordsFromGoogleLink = function(link) {
            try {
                // Ù†Ù…Ø·: @lat,lng  Ø£Ùˆ /place/.../@lat,lng,zoom
                const m = link.match(/@(-?\d+\.?\d*),(-?\d+\.?\d*)/);
                if (m) return { lat: parseFloat(m[1]), lng: parseFloat(m[2]) };
            } catch (e) {}
            return null;
        }

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙƒØ² Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ (Ø£Ùˆ Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„)
        window.addCenterFromDashboard = async function() {
            const name = document.getElementById('centerName').value.trim();
            const link = document.getElementById('centerLink').value.trim();
            const desc = document.getElementById('centerDesc').value.trim();
            const latVal = document.getElementById('centerLat').value.trim();
            const lngVal = document.getElementById('centerLng').value.trim();
            const editId = document.getElementById('editingCenterId').value;
            const msg = document.getElementById('centerMessage');

            if (!name || !link) {
                msg.innerHTML = '<span class="message error">âŒ Ø§Ù…Ù„Ø£ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ø§Ø¨Ø·</span>';
                return;
            }

            let lat = parseFloat(latVal);
            let lng = parseFloat(lngVal);
            if (isNaN(lat) || isNaN(lng)) {
                const parsed = window.parseCoordsFromGoogleLink(link);
                if (parsed) { lat = parsed.lat; lng = parsed.lng; }
                else { lat = undefined; lng = undefined; }
            }

            try {
                const id = editId || Date.now().toString();
                const data = { id, name, address: desc, link };
                if (typeof lat !== 'undefined' && typeof lng !== 'undefined') { data.lat = lat; data.lng = lng; }

                await setDoc(doc(db, 'centers', id), data);

                msg.innerHTML = '<span class="message success">âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø±ÙƒØ²</span>';
                document.getElementById('centerName').value = '';
                document.getElementById('centerLink').value = '';
                document.getElementById('centerDesc').value = '';
                document.getElementById('centerLat').value = '';
                document.getElementById('centerLng').value = '';
                document.getElementById('editingCenterId').value = '';

                // refresh local list (onSnapshot will handle but call render)
                window.loadCentersFromCloud && window.loadCentersFromCloud();
                setTimeout(() => msg.innerHTML = '', 2500);
            } catch (e) {
                console.error('Ø®Ø·Ø£ Ø­ÙØ¸ Ø§Ù„Ù…Ø±ÙƒØ²:', e);
                msg.innerHTML = '<span class="message error">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£</span>';
            }
        }

        // Render centers table in teacher dashboard
        window.renderCentersDashboard = function() {
            const table = document.getElementById('centers-table');
            if (!table) return;
            const centers = JSON.parse(localStorage.getItem('centers') || '[]');
            if (centers.length === 0) {
                table.innerHTML = '<tr><td colspan="4" class="empty-cell">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±Ø§ÙƒØ²</td></tr>';
                return;
            }
            table.innerHTML = '';
            centers.forEach(c => {
                const row = table.insertRow();
                row.setAttribute('data-id', c.id);
                row.innerHTML = `
                    <td>${c.name}</td>
                    <td>${c.address || '-'}</td>
                    <td><a href="${c.link}" target="_blank">Ø±Ø§Ø¨Ø·</a></td>
                    <td>
                        <button class="btn btn-warning btn-small" onclick="editCenterDashboard('${c.id}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                        <button class="btn btn-danger btn-small" onclick="deleteCenterFromDashboard('${c.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                    </td>
                `;
            });
        }

        window.editCenterDashboard = function(id) {
            const centers = JSON.parse(localStorage.getItem('centers') || '[]');
            const c = centers.find(x => x.id === id);
            if (!c) return alert('Ø§Ù„Ù…Ø±ÙƒØ² ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
            document.getElementById('centerName').value = c.name || '';
            document.getElementById('centerLink').value = c.link || '';
            document.getElementById('centerDesc').value = c.address || '';
            document.getElementById('centerLat').value = c.lat || '';
            document.getElementById('centerLng').value = c.lng || '';
            document.getElementById('editingCenterId').value = c.id;
            window.scrollTo({ top: document.getElementById('centerName').offsetTop - 100, behavior: 'smooth' });
        }

        window.deleteCenterFromDashboard = async function(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙƒØ²ØŸ')) return;
            try {
                await deleteDoc(doc(db, 'centers', id));
                // onSnapshot will update localStorage and UI
                alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø±ÙƒØ²');
            } catch (e) {
                console.error('Ø®Ø·Ø£ Ø­Ø°Ù Ø§Ù„Ù…Ø±ÙƒØ²:', e);
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù');
            }
        }

        // Watch centers in dashboard: render when localStorage updated
        if (typeof window.loadCentersFromCloud === 'function') {
            // ensure local render is available immediately
            try { renderCentersDashboard(); } catch(e){}
        }

        // Load centers from Firestore (teacher page) and keep localStorage in sync
        window.loadCentersFromCloud = function() {
            try {
                const q = query(collection(db, 'centers'));
                onSnapshot(q, (snapshot) => {
                    const centers = [];
                    snapshot.forEach(docSnap => centers.push(docSnap.data()));
                    localStorage.setItem('centers', JSON.stringify(centers));
                    renderCentersDashboard();
                });
            } catch (e) {
                console.error('Ø®Ø·Ø£ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø±Ø§ÙƒØ²:', e);
            }
        }

        // ÙØªØ­ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©
        window.joinMeeting = function(link) {
            if (!link) return alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· ØµØ§Ù„Ø­ Ù„Ù„Ø§Ø¬ØªÙ…Ø§Ø¹');
            window.open(link, '_blank');
        }

        // ØªØ­Ø¯ÙŠØ« Ø¯ÙˆØ±ÙŠ Ù„Ù„Ø­Ø§Ù„Ø© ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
        setInterval(() => {
            try { window.updateMeetingButtons(); } catch(e) {}
        }, 30000);
    </script>

    </footer>

    <script type="module" src="script.js"></script>
</body>
</html>
    </footer>

    <script type="module" src="script.js"></script>
</body>
</html>