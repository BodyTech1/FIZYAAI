<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุตู ุงูุซุงูู ุงูุซุงููู - ุงูุงูุชุญุงูุงุช</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav>
        <div class="navbar">
            <a href="index.html" class="logo">ูุฒูุงุฆู</a>
            <div>
                <div class="dropdown">
                    <a href="#">๐ ุงูุตููู</a>
                    <div class="dropdown-content">
                        <a href="class-1.html">ุงูุตู ุงูุฃูู ุงูุซุงููู</a>
                        <a href="class-2.html">ุงูุตู ุงูุซุงูู ุงูุซุงููู</a>
                        <a href="class-3.html">ุงูุตู ุงูุซุงูุซ ุงูุซุงููู</a>
                    </div>
                </div>
                <a href="exams.html">ุงูุงูุชุญุงูุงุช</a>
                <a href="login.html">ุชุณุฌูู ุงูุฏุฎูู</a>
                <a href="register.html">ุชุณุฌูู ุฌุฏูุฏ</a>
                <a href="teacher.html" id="teacher-dashboard" class="hidden">๐จโ๐ซ ููุญุฉ ุงูุชุญูู</a>
                <button onclick="toggleDarkMode()" id="dark-mode-btn">๐</button>
            </div>
        </div>
    </nav>

    <div class="container-large">
        <h1>ุงูุตู ุงูุซุงูู ุงูุซุงููู - ุงูุงูุชุญุงูุงุช</h1>
        <p class="subtitle-text">ุงุทูุน ุนูู ุฌููุน ุงูุชุญุงูุงุช ุงูุตู ุงูุซุงูู ุงูุซุงููู</p>
        
        <div id="exams-container" class="exams-grid"></div>
    </div>

    <footer>
        <p>&copy; 2026 ููุตุฉ ูุฒูุงุฆู - ุฌููุน ุงูุญููู ูุญููุธุฉ</p>
    </footer>

    <script type="module" src="script.js"></script>
</body>
</html>
            const isDark = localStorage.getItem('darkMode')==='true';
            const btn=document.getElementById('dark-mode-btn');
            if(isDark){document.body.classList.add('dark-mode'); if(btn)btn.textContent='โ๏ธ'}
            else{document.body.classList.remove('dark-mode'); if(btn)btn.textContent='๐'}
        }
        function toggleDarkMode(){
            const isDark = localStorage.getItem('darkMode')==='true';
            localStorage.setItem('darkMode',!isDark);
            initDarkMode();
        }
        function checkTeacherLogin(){
            const isTeacher = localStorage.getItem('isTeacher')==='true';
            const dashboardBtn = document.getElementById('teacher-dashboard');
            if(isTeacher){
                if(dashboardBtn) dashboardBtn.style.display='inline-block';
            }
        }
        
        function renderExams(){
            const container = document.getElementById('exams-container');
            const allExams = JSON.parse(localStorage.getItem('exams') || '[]');
            const exams = allExams.filter(e => e.class == 2);
            
            container.innerHTML = '';
            if(exams.length === 0){
                container.innerHTML = '<p class="empty-state">ูุง ุชูุฌุฏ ุงูุชุญุงูุงุช ูุชุงุญุฉ</p>';
                return;
            }
            
            exams.forEach(e => {
                const imagesList = e.images || (e.data ? [e.data] : []);
                let imagesHtml = '';
                if(imagesList.length > 0){
                    imagesList.forEach(img => {
                        imagesHtml += `<img src="${img}" alt="ุตูุฑุฉ ุงูุชุญุงู">`;
                    });
                }
                
                const card = document.createElement('div');
                card.className = 'exam-card';
                card.innerHTML = `
                    <div class="exam-card-images">${imagesHtml}</div>
                    <div class="exam-card-info">
                        <div class="exam-card-title">${e.name}</div>
                        <div class="exam-card-desc">${e.description || 'ุจุฏูู ูุตู'}</div>
                        <div class="exam-card-date">๐ ${e.date}</div>
                        <div class="exam-card-actions">
                            <button class="btn btn-primary btn-small" onclick="downloadExam('${e.id}')">โฌ๏ธ ุชุญููู</button>
                            <button class="btn btn-secondary btn-small" onclick="viewImages('${e.id}')">๐๏ธ ุนุฑุถ</button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }
        
        function downloadExam(id){
            const exams = JSON.parse(localStorage.getItem('exams') || '[]');
            const exam = exams.find(e => e.id === id);
            if(!exam) return;
            
            const imagesList = exam.images || (exam.data ? [exam.data] : []);
            if(imagesList.length === 0) {
                alert('ูุง ุชูุฌุฏ ุตูุฑ ูุชุญููููุง');
                return;
            }
            
            // ุชุญููู ูู ุงูุตูุฑ
            imagesList.forEach((img, index) => {
                const link = document.createElement('a');
                link.href = img;
                link.download = `${exam.name}_${index + 1}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });
            
            alert(`โ ุชู ุชุญููู ${imagesList.length} ุตูุฑุฉ ูู ุงูุงูุชุญุงู "${exam.name}"`);
        }
        
        let currentImageIndex = 0;
        let currentExamImages = [];
        
        function viewImages(id){
            const exams = JSON.parse(localStorage.getItem('exams') || '[]');
            const exam = exams.find(e => e.id === id);
            if(!exam) return;
            
            const imagesList = exam.images || (exam.data ? [exam.data] : []);
            if(imagesList.length === 0) {
                alert('ูุง ุชูุฌุฏ ุตูุฑ');
                return;
            }
            
            currentExamImages = imagesList;
            currentImageIndex = 0;
            
            // ุฅูุดุงุก lightbox
            let lightbox = document.getElementById('exam-lightbox');
            if(!lightbox) {
                lightbox = document.createElement('div');
                lightbox.id = 'exam-lightbox';
                lightbox.className = 'lightbox';
                lightbox.innerHTML = `
                    <div class="lightbox-content">
                        <button class="lightbox-close" onclick="closeLightbox()">โ</button>
                        <button class="lightbox-nav lightbox-prev" onclick="prevImage()">โฎ</button>
                        <img id="lightbox-image" class="lightbox-image" src="" alt="ุตูุฑุฉ ุงูุงูุชุญุงู">
                        <button class="lightbox-nav lightbox-next" onclick="nextImage()">โฏ</button>
                        <div class="lightbox-counter"><span id="image-counter">1/1</span></div>
                    </div>
                `;
                document.body.appendChild(lightbox);
            }
            
            updateLightboxImage();
            lightbox.classList.add('active');
        }
        
        function updateLightboxImage() {
            const img = document.getElementById('lightbox-image');
            const counter = document.getElementById('image-counter');
            img.src = currentExamImages[currentImageIndex];
            counter.textContent = `${currentImageIndex + 1}/${currentExamImages.length}`;
        }
        
        function nextImage() {
            currentImageIndex = (currentImageIndex + 1) % currentExamImages.length;
            updateLightboxImage();
        }
        
        function prevImage() {
            currentImageIndex = (currentImageIndex - 1 + currentExamImages.length) % currentExamImages.length;
            updateLightboxImage();
        }
        
        function closeLightbox() {
            const lightbox = document.getElementById('exam-lightbox');
            if(lightbox) lightbox.classList.remove('active');
        }
        
        // ุฅุบูุงู lightbox ุนูุฏ ุงูุถุบุท ุฎุงุฑุฌู
        document.addEventListener('click', function(e) {
            const lightbox = document.getElementById('exam-lightbox');
            if(lightbox && e.target === lightbox) {
                closeLightbox();
            }
        });
        
        // ุงูุชููู ุนุจุฑ ููุญุฉ ุงูููุงุชูุญ
        document.addEventListener('keydown', function(e) {
            const lightbox = document.getElementById('exam-lightbox');
            if(lightbox && lightbox.classList.contains('active')) {
                if(e.key === 'ArrowRight') nextImage();
                if(e.key === 'ArrowLeft') prevImage();
                if(e.key === 'Escape') closeLightbox();
            }
        });
        
        document.addEventListener('DOMContentLoaded', () => {
            initDarkMode();
            checkTeacherLogin();
            // ูุง ูุณุชุฏุนู renderExams ููุง - ุณูุชู ุงุณุชุฏุนุงุคูุง ูู Firebase
        });
    </script>
    <script type="module">
        import { getFirestore, collection, query, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyDimAkjqtt8nl4Her0vqtHVMu4xkluUuqs",
            authDomain: "fizyai.firebaseapp.com",
            projectId: "fizyai",
            storageBucket: "fizyai.firebasestorage.app",
            messagingSenderId: "172902934430",
            appId: "1:172902934430:web:ab440e76ef738e5499588f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // ุชุญููู ุงูุงูุชุญุงูุงุช ูู Firebase - ุงูู ูุง ุชูุชุญ ุงูุตูุญุฉ
        const q = query(collection(db, 'exams'));
        onSnapshot(q, (snapshot) => {
            const exams = [];
            snapshot.forEach((doc) => {
                exams.push(doc.data());
            });
            console.log('ุชู ุชุญููู ุงูุงูุชุญุงูุงุช ูู Firebase:', exams);
            localStorage.setItem('exams', JSON.stringify(exams));
            // ุงุณุชุฏุนุงุก render ุจุนุฏ ุญูุธ ุงูุจูุงูุงุช ูุจุงุดุฑุฉ
            window.renderExams();
        });
    </script>
</body>
</html>
